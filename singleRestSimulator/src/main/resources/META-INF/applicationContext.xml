<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright 2014 Cisco Systems, Inc.
  ~
  ~  Licensed under the Apache License, Version 2.0 (the "License");
  ~  you may not use this file except in compliance with the License.
  ~  You may obtain a copy of the License at
  ~
  ~  http://www.apache.org/licenses/LICENSE-2.0
  ~
  ~  Unless required by applicable law or agreed to in writing, software
  ~  distributed under the License is distributed on an "AS IS" BASIS,
  ~  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  ~  See the License for the specific language governing permissions and
  ~  limitations under the License.
  -->

<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:context="http://www.springframework.org/schema/context"
    xmlns:jaxrs="http://cxf.apache.org/jaxrs"
    xmlns:tx="http://www.springframework.org/schema/tx"
    xsi:schemaLocation="
    http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
    http://www.springframework.org/schema/context
    http://www.springframework.org/schema/context/spring-context-2.5.xsd
    http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-2.0.xsd
    http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd"

    default-lazy-init="true" default-init-method="startup"
    default-destroy-method="shutdown">

   <import resource="classpath:/META-INF/cabConfigurationInfraContext.xml" />

    <!-- Manually start server after setting parent context. (init-method="start") -->
    <bean id="restSimJettyServer" class="org.mortbay.jetty.Server" destroy-method="stop">
        <property name="connectors">
            <list>
                <bean id="Connector" class="org.mortbay.jetty.nio.SelectChannelConnector">
                     <property name="port" value="${restSimulator.http.port}"/>           
                </bean>
            </list>
        </property>
        <property name="handlers">
            <list>
                <bean class="org.mortbay.jetty.servlet.Context">
                    <property name="contextPath" value="/"/>
                    <property name="sessionHandler">
                        <bean class="org.mortbay.jetty.servlet.SessionHandler" />
                    </property>
                    <property name="servletHandler">
                        <bean class="org.mortbay.jetty.servlet.ServletHandler">
                            <property name="servlets">
                                <list>
                                    <bean class="org.mortbay.jetty.servlet.ServletHolder">
                                        <property name="name" value="jersey" />
                                        <property name="servlet">
                                            <bean class="com.sun.jersey.spi.spring.container.servlet.SpringServlet" />
                                        </property>
                                        <property name="initParameters">
                                             <map>
                                             <entry key="com.sun.jersey.spi.container.ContainerRequestFilters"
                                                value="com.sun.jersey.api.container.filter.LoggingFilter" />
                                            <entry key="com.sun.jersey.spi.container.ContainerResponseFilters"
                                                value="com.sun.jersey.api.container.filter.LoggingFilter" />
                                        </map>
                                        </property>
                                    </bean>
                                </list>
                            </property>                      
                            <property name="servletMappings">
                                <list>
                                    <bean class="org.mortbay.jetty.servlet.ServletMapping">
                                        <property name="servletName" value="jersey"/>
                                        <property name="pathSpecs">
                                            <list>
                                                <value>/*</value>
                                            </list>
                                        </property>
                                    </bean>
                                </list>
                            </property>
                        </bean>
                    </property>
                    <property name="eventListeners">
                        <list>
                            <bean id="requestContextListener" class="org.springframework.web.context.request.RequestContextListener"/>
                            <bean id="contextLoaderListener" class="org.springframework.web.context.ContextLoaderListener"/>
                        </list>
                    </property>
                    <property name="initParams">
                        <map>
                            <entry key="contextConfigLocation" value="classpath:META-INF/restSimulatorContext.xml"/>
                        </map>
                    </property>
                </bean><!--
            --></list>
        </property>
    </bean>

</beans>